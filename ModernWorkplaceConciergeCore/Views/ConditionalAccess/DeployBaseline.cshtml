
@model IEnumerable<String>
@{
    ViewBag.Current = "ConditionalAccessDeployBasline";
}

<div class="jumbotron">
    <h1>Deploy Conditional Access Basline</h1>

    <p>Deploy a rock solid set of Conditional Access Policies including the creation and assignment of exclusion groups. Policy sets are provided by <a href="https://github.com/AlexFilipin/ConditionalAccess" target="_blank">@@AlexFilipin</a>. Kudos for his excellent work!</p>
    <ol>
        <li>Deploy a policy set</li>
        <li>Add users like break glass and AAD connect accounts to the exclusion group</li>
        <li>Enable the policies</li>
    </ol>
</div>

@using (Html.BeginForm("DeployBaseline", "ConditionalAccess", FormMethod.Post, new { @class = "form", enctype = "multipart/form-data", autocomplete = "off" }))
{
    <input type="text" name="clientId" class="d-none" id="clientId" required>
    <div class="form-row">
        <div class="col">
            <div class="form-group">
                <label for="displayName">Conditional Access Excluded Group</label>
                <input type="text" name="displayName" class="form-control" data-toggle="tooltip" data-placement="bottom" placeholder="aad-conditional-access-exclusions" id="displayName" required>
            </div>
        </div>
        <div class="col">
            <div class="form-group">
                <label for="allowLegacyAuth">Legacy Authentication Excluded Group</label>
                <input type="text" name="allowLegacyAuth" class="form-control" data-toggle="tooltip" data-placement="bottom" placeholder="aad-conditional-access-allow-legacy-auth" id="allowLegacyAuth" required>
            </div>
        </div>
    </div>
    <div class="form-row">
        <div class="col">
            <div class="form-group">
                <label for="policyPrefix">Conditional Access Policy Prefix (optional)</label>
                <input type="text" name="policyPrefix" class="form-control" data-toggle="tooltip" data-placement="bottom" id="policyPrefix" placeholder="CAR -">
            </div>
        </div>
        <div class="col">
            <div class="form-group">
                <label for="selectedBaseline">Conditional Access Policy Set</label>
                @Html.DropDownList("selectedBaseline", new SelectList(Model), new { @class = "form-control", data_toggle = "tooltip", data_placement = "bottom" })
            </div>
        </div>
    </div>
    <div class="form-row">
        <div class="col">
            <div class="form-group">
                <button class="btn btn-info" type="submit" id="upload">Deploy ✨</button>
            </div>
        </div>
    </div>
}

@section scripts {
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/Scripts/jquery.signalR-2.4.1.min.js"></script>
    <script src="~/signalr/hubs"></script>
    <!--SignalR script to update the chat page and send messages.-->
    <script src="~/Content/MwConciergeSignalR.js"></script>

    <!-- Tooltips -->
    <script>
        $('#displayName').tooltip({ 'trigger': 'focus', 'title': 'This Azure AD Group will be created (if it does not exist) and excluded from all Conditional Access policies.' });
        $('#allowLegacyAuth').tooltip({ 'trigger': 'focus', 'title': 'This Azure AD Group will be created (if it does not exist) and excluded from the policy preventing legacy authentication.' });
        $('#policyPrefix').tooltip({ 'trigger': 'focus', 'title': 'This optional prefix will be added to each policies display name.' });
        $('#selectedBaseline').tooltip({ 'trigger': 'focus', 'title': 'Select your desired conditional access policy set.' });
    </script>
}
